FROM wordpress:php8.2-fpm

# Instalar WP-CLI
ADD https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar /usr/local/bin/wp
RUN chmod +x /usr/local/bin/wp

# Instalar herramientas Ãºtiles
USER root
RUN apt update && apt install -y \
    iputils-ping \
    netcat-openbsd \
    mariadb-client \
    iproute2 \
    curl \
    vim \
    less \
    bash \
  && rm -rf /var/lib/apt/lists/*

# Aumentar memoria de PHP para evitar fallos en WP-CLI
COPY ./conf/php.ini /usr/local/etc/php/conf.d/memory-limit.ini

# ConfiguraciÃ³n PHP-FPM y scripts de inicializaciÃ³n
COPY ./conf/www.conf /usr/local/etc/php-fpm.d/www.conf
COPY ./conf/install-wp.sh /docker-entrypoint-initwp.d/install-wp.sh

# Permisos
RUN chmod +x /docker-entrypoint-initwp.d/install-wp.sh

EXPOSE 9000

ENTRYPOINT ["/bin/sh", "-c", "for f in /docker-entrypoint-initwp.d/*.sh; do echo \"ðŸš€ Ejecutando $f\"; bash $f; done && exec php-fpm"]
